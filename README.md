# bbb-controller

## Api v1

The api is accessable under `/api/v1/{endpoint}`.

### Authentication
Authentication to the API is done via [RCP](https://github.com/myOmikron/rcp).
The endpoint is used as salt whereas the key for the checksum is `checksum`.
The authentication is required at every endpoint.

### Parameters and responses

In `POST` requests, parameters and the authentication checksum has to be provided as a valid json object in the request's body.

Unless stated otherwise, every endpoint responds with a valid json object of the following form:

```json
{
  "success": true,
  "message": "This is a short summary or error message"
}
```

The following are status codes shared by every endpoint:

Status code     | Message                                     | Cause
----------------|---------------------------------------------|----------------------------------------------
400 Bad Request | Decoding data failed.                       | The request's body wasn't a valid json object.
400 Bad Requst  | No checksum was given.                      | There is no checksum parameter. See Authentication above.
400 Bad Request | Checksum was incorrect.                     | Perhaps wrong salt (= endpoint), wrong secret or times out of sync.
400 Bad Request | Parameter {param} is mandatory but missing. | A required parameter is missing.

### External Endpoints

#### `startStream`

This method starts a stream for a running bigbluebutton meeting.

The starting process may take a minute, but since this project only forwards commands to others, this method will respond before the stream is actually running.

- Method: `POST`

Parameters      | Required | Type | Description
----------------|----------|------|------------
meeting_id      | Yes      | str  | The id of a running bigbluebutton meeting.
welcome_msg     | No       | str  | A welcome message that gets displayed on the chat window when the participant joins.
redirect_url    | No       | str  | An url to redirect the users to, once the stream ended.

Status code      | Message                                     | Cause
-----------------|---------------------------------------------|----------------------------------------------
404 Not Found    | No matching running meeting found.          | The `meeting_id` doesn't correspond to any running meeting. Perhaps it wasn't created yet.
304 Not Modified | There is already a stream running.          | The meeting is already being streamed.
200 OK           | Stream started successfully.                |

#### `joinStream`

Redirect a user to where he can watch the streamed meeting.

This endpoint's url needs to be generated by an authorized party and then requested by the user himself.

Similar to bbb's join, this ensures that the user came from an authorized location.

It does not respond with a json object but redirects the requester to the [frontend](https://github.com/myOmikron/bbb-frontend)

- Method `GET`

Parameters      | Required | Type | Description
----------------|----------|------|------------
meeting_id      | Yes      | str  | The id of a streamed bigbluebutton meeting.
user_name       | Yes      | str  | User's name to display in participants list and chat

Status code     | Message                                      | Cause
----------------|----------------------------------------------|-----------------------------------------------------
404 Not Found   | There is no stream running for this meeting. | Wrong `meeting_id` or the stream wasn't started yet.
302 Found       | ---                                          | Request was successful, now redirect to the frontend.

#### `endStream`

This method stops a bigbluebutton meeting's stream.

- Method: `POST`

Parameters      | Required | Type | Description
----------------|----------|------|------------
meeting_id      | Yes      | str  | The id of a streamed bigbluebutton meeting.

Status code     | Message                                      | Cause
----------------|----------------------------------------------|-----------------------------------------------------
404 Not Found   | There is no stream running for this meeting. | Wrong `meeting_id` or the stream wasn't started yet.
200 OK     | Stream stopped successfully.                 |

### Internal Endpoints

TODO
